# Pull Request Template – TrainU Interim App

> Title format: `[PF:<ticket-id>] <concise summary>`

## Context / Why
- **Ticket:** PF-<id> (link)
- **Problem:** What is broken or missing?
- **Solution summary:** One–two sentences on the approach.
- **Scope:** What this PR does change.
- **Out of scope:** What this PR does not change.

## PLAN
- [ ] Step 1: …
- [ ] Step 2: …
- [ ] Step 3: …

> Generated by PocketFlow? Include: **run_id**, **correlation_id**, link to **agent_events** view.

## DIFF (high-level)
- Key files:
  - `apps/web/...`
  - `apps/agent/...`
  - `infra/supabase/schema.sql` (if any migration)
- API or contract changes? Update `API_CONTRACTS.md` in this PR.
- New env vars? Update `.env.example` + one-line comment in `CONFIG.md`.

## TEST
**Local:**
```bash
pnpm -C apps/web dev
pnpm -C apps/agent dev
```

* [ ] Typecheck/lint pass
* [ ] Manual QA checklist:

  * [ ] Auth flow works (sign-in/sign-out)
  * [ ] Trainer directory renders without errors
  * [ ] Profile page CTA opens GHL booking
  * [ ] Goals page shows progress for sample data
* Webhooks (if applicable):

  * [ ] Receive GHL event → row in `webhook_events`
  * [ ] Snapshot upsert succeeds (no duplicates)
* PostHog:

  * [ ] Events captured (auth, view profile, book CTA)
* Sentry:

  * [ ] No new unhandled errors in console or server logs

## RISKS & ROLLBACK

* **Risks:** e.g., webhook spam, rate limits, PII exposure, schema mismatch
* **Blast radius:** limited to …
* **Rollback:** revert commit / feature-flag off / run down-migration
* **Data:** backfill/forward-fill needed?

## Checklists

**Security & Privacy**

* [ ] No secrets committed (run `scripts/check_forbidden_tokens.sh`)
* [ ] PII redaction in logs confirmed
* [ ] CORS remains restricted to `app.trainu.online`

**Observability**

* [ ] PostHog events added/updated
* [ ] Sentry instrumentation present where new failure modes exist

**Docs**

* [ ] Updated: `README.md` / `ARCHITECTURE.md` / `OBSERVABILITY.md` / `RUNBOOKS/*` as needed

**Config & Schema**

* [ ] New env vars documented in `.env.example` & `CONFIG.md`
* [ ] SQL changes documented and backward compatible (or clear migration steps)

**GHL Integration**

* [ ] Any new endpoints added in `apps/web/lib/ghl.ts`
* [ ] Webhook handler remains idempotent; signature verified when secret available

## Acceptance Criteria Mapping

| Acceptance      | Evidence            |
| --------------- | ------------------- |
| A1: <criterion> | screenshot/log/test |
| A2: <criterion> |                     |

## Deployment Steps

1. Apply SQL if any
2. Set new envs in Vercel/Supabase
3. Redeploy `apps/web`

## Post-merge Tasks

* [ ] Announce change in #trainu-dev
* [ ] Open follow-up ticket(s) (if needed)

---

**Sign-off:**

* [ ] Author
* [ ] Reviewer
* [ ] Product/Owner (if user-visible)
* [ ] Security/Data (if schema/logging touched)
